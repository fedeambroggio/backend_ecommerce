<!DOCTYPE html>
<html>
    <head>
        <title>Cliente Socket</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.2.0/socket.io.js"></script>
    </head>
    <body>
        <div id="messages"></div>

        <form id="messageForm">
            <input type="text" id="emailInput" placeholder="Email" />
            <input type="text" id="cuerpoInput" placeholder="Mensaje" />
            <button type="submit">Enviar Mensaje</button>
        </form>

        <script>
            // Conectar al servidor WebSocket
            const socket = io();

            socket.on("all messages", (messages) => {
                const messagesDiv = document.getElementById("messages");
                messages.forEach((message) => {
                    const messageElement = document.createElement("p");
                    messageElement.textContent = message.cuerpo;
                    messagesDiv.appendChild(messageElement);
                });
            });

            // Manejar eventos de recepción de mensajes
            socket.on("chat message", (message) => {
                // Agregar el mensaje recibido al div de mensajes
                const messagesDiv = document.getElementById("messages");
                const messageElement = document.createElement("p");
                messageElement.textContent = message.cuerpo;
                messagesDiv.appendChild(messageElement);
            });

            // Manejar el envío del formulario
            const messageForm = document.getElementById("messageForm");
            messageForm.addEventListener("submit", (event) => {
                event.preventDefault();

                // Obtener los valores del formulario
                const email = document.getElementById("emailInput").value;
                const cuerpo = document.getElementById("cuerpoInput").value;

                // Crear el objeto de mensaje
                const message = {
                    email: email,
                    cuerpo: cuerpo,
                };

                // Enviar el mensaje al servidor WebSocket
                socket.emit("chat message", message);

                // Limpiar los campos del formulario
                document.getElementById("emailInput").value = "";
                document.getElementById("cuerpoInput").value = "";
            });
        </script>
    </body>
</html>
